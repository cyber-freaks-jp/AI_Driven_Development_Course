# 本番環境でのバグ調査

本番環境で発生したバグって緊急性があるのですぐに解決したいですよね。
**本番環境の情報をAIに渡すことができれば、迅速に解決できます。**

### 本番環境の情報とは

AIに渡すべき「本番環境の情報」には、以下のような情報が含まれます：

- データベースのダンプデータ
- 各種ログ
- インフラのメトリクス（CPU、メモリ、ネットワーク使用率）
- ミドルウェアの設定ファイル（Nginx、MySQL、Redis設定など）
- クラウドリソース情報（AWSのEC2設定、Security Group等）

これらの情報をAIに与えることで、以下のようなバグを調査できます：

| バグの種類          | AIが分析する情報                 |
| -------------- | ------------------------- |
| **アプリケーションバグ** | ログ + DB + コード             |
| **インフラ障害**     | EC2設定 + ミドルウェア設定 + システムログ |
| **パフォーマンス問題**  | メトリクス + スロークエリログ + コード    |

## ただし、セキュリティリスクがある

本番環境のデータには、個人情報や機密情報が含まれています。
**そのため、本番環境で直接AIツールを使うことは絶対にやめましょう**

では、どうすれば安全にAIを活用できるのか？
答えは、「本番環境の情報を、安全な隔離環境にコピーしてからAIに渡す」**ことです

## 本番の情報を安全にAIに渡す方法のアイデア

運用現場によって対応方法は変わりますが、以下のようなアイデアが考えられます。

### アイデア1：サンドボックス環境にデータをコピー

本番のデータベースやAPIにアクセスできない、隔離された「サンドボックス環境」を用意し、その環境に本番のデータをコピーする方法があります

このサンドボックス環境は、ローカルのDocker環境でも構いません

とにかく、
- 本番へ影響を与えない
- AIが暴走して何をやっても大丈夫な環境
なら、どこでもOKです


**イメージ**：
```
本番DB → ダンプ取得 → サンドボックスDBに復元
本番ログ → サンドボックスDBにコピー
```


このような環境でAIにバグの調査依頼を出すことで、本番環境でのバグを迅速に調査することが可能になります

⚠️注意点：
* 本番の機密データは必要に応じて潰しましょう。例えば、DBのUserテーブルに個人情報がある場合は、それをローカル環境に移行する際、SQL文で個人情報をダミーデータに置換するなどセキュリティの考慮をしましょう

### アイデア2：本番EC2インスタンスのコピー環境を作る

例えばAWSの場合、本番EC2インスタンスをコピーすることで、より本番に近いサンドボックス環境を作ることができます。
これなら、インフラレベルの障害調査もしやすくなります。

注意点として、本番DBやAPIへのアクセスを遮断するなど、AIがいくら暴走しても本番には影響を与えないような隔離環境にしましょう

---

**重要**：どの方法を使うかは、組織のセキュリティポリシーや運用ルールによって異なります。**必ず上司やセキュリティ担当者に相談してから実施してください。**


## 重要なセキュリティ原則

本番環境の情報をAIに渡す際は、以下の原則を必ず守ってください。

### 原則1：本番環境で直接AIツールを使わない

- 本番環境でCursor、Claude Code等のAIツールを直接使用しない
- 本番サーバーにAIツールをインストールしない
- 必ず隔離された環境にコピーしてから使う

### 原則2：ローカル環境でもサンドボックス環境を使う

ローカル環境にAIツールがインストールされていて、かつその環境から本番にSSH接続ができてしまう場合、**AIが本番環境にアクセスできてしまうため、これも絶対にNGです。**

AIが本番DBを勝手に更新するなど、何をしでかすか分からないリスクがあります。

**正しい方法**：
- ローカル環境上に**サンドボックス環境（Docker等）を立てる**
- そのサンドボックス環境の中でAIツールを使う
- サンドボックス環境からは本番に接続できないようにする（SSH設定を分離）

ローカル環境でAIを使う場合は、必ずDocker等の隔離環境を使い、その環境から本番への通信を遮断してください。

### 原則3：機密情報を除外・マスキング(ダミーデータに置換)する

**除外すべきデータ**：
- 個人情報（氏名、メールアドレス、電話番号、住所）
- 決済情報、クレジットカード情報
- 認証情報（パスワード、トークン、APIキー）
など

**マスキング方法**：
- 個人情報はダミーデータに置換（例：`test001@example.com`）
- ログの機密情報をマスキング（例：トークンを `***` に置換）
- 決済情報のテーブルは丸ごと除外

### 原則4：必ず上司・セキュリティ担当に相談する

- 本番データの取り扱いは個人判断で行わない
- データのコピーや調査方法について、必ず上司の許可を取る
- 組織のセキュリティポリシーに従う
- 不明な点があれば、セキュリティ担当者に相談


## まとめ

本番環境のコンテキスト（ログ、DB、インフラ情報）をAIに安全に渡すことができれば、本番で発生したバグであってもAIで迅速に解決できます。

### 重要なポイント

1. **AIに「本番環境の状態」を再現できる情報を渡すことが鍵**
2. **どの方法を使うかは、組織のポリシーによって異なる**
3. **必ずセキュリティに配慮し、上司に相談する**

