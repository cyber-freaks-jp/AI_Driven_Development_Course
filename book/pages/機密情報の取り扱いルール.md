# 機密情報の取り扱いルール

技術的な対策だけでなく、運用ルールの徹底が情報漏洩を防ぐ鍵です。このセクションでは、開発現場で実践すべき機密情報の取り扱いルールを解説します。

## 機密情報の定義

### 絶対にAIに与えてはいけない情報

#### 1. 認証情報

```
❌ 絶対NG
- APIキー
- パスワード
- アクセストークン
- 秘密鍵（private key）
- データベース接続文字列
- OAuth クライアントシークレット
```

#### 2. 個人情報・顧客データ

```
❌ 絶対NG
- 実際の顧客名
- メールアドレス
- 電話番号
- 住所
- クレジットカード情報
- マイナンバー
```

#### 3. 企業機密

```
❌ 絶対NG
- 独自アルゴリズムの詳細
- 未発表の製品情報
- 契約条件
- 財務情報
- M&A情報
```

### 注意が必要な情報

#### 1. ビジネスロジック

```
⚠️ 注意
- 料金計算ロジック
- 推薦アルゴリズム
- 独自のデータ構造

→ 一般的なロジックは問題ないが、
　 競争優位性のある独自ロジックは注意
```

#### 2. 設計書・要件定義書

```
⚠️ 注意
- マークダウン駆動開発では設計書をAIに参照させる
- 機密性の高い情報は除外してから参照させる
```

## 実践的な運用ルール

### ルール1：プレースホルダーを使う

実際の値ではなく、プレースホルダーを使用します。

#### ❌ 悪い例

```python
# AIに以下をそのまま送信
database_url = "postgresql://admin:P@ssw0rd123@db.example.com:5432/production"
api_key = "sk-1234567890abcdefghijklmnop"
```

#### ✅ 良い例

```python
# プレースホルダーに置き換えてから送信
database_url = "postgresql://USER:PASSWORD@HOST:PORT/DATABASE"
api_key = "YOUR_API_KEY_HERE"
```

### ルール2：サンプルデータを使う

実際のデータではなく、ダミーデータを使用します。

#### ❌ 悪い例

```python
# 実際の顧客データ
users = [
    {"name": "田中太郎", "email": "tanaka@example.com", "phone": "090-1234-5678"},
    {"name": "佐藤花子", "email": "sato@example.com", "phone": "080-9876-5432"}
]
```

#### ✅ 良い例

```python
# ダミーデータ
users = [
    {"name": "ユーザーA", "email": "user_a@example.com", "phone": "090-0000-0000"},
    {"name": "ユーザーB", "email": "user_b@example.com", "phone": "090-1111-1111"}
]
```

### ルール3：設計書から機密情報を分離

#### プロジェクト構成

```
Docs/
  ├── 要件定義書.md           # AIに参照させる
  ├── 設計書.md               # AIに参照させる
  ├── API設計.md              # AIに参照させる
  └── secrets/                # AIには絶対に参照させない
      ├── 機密事項.md
      ├── 料金体系詳細.md
      └── パートナー契約.md
```

#### .gitignoreと.cursorignoreで除外

```
# .cursorignore
Docs/secrets/
config/credentials.yml
.env*
*.key
*.pem
```

### ルール4：コードレビュー時のマスキング

AIにコードレビューを依頼する前に、機密情報をマスキングします。

#### 自動マスキングスクリプト

```python
# mask_secrets.py
import re

def mask_code(code):
    # APIキーをマスク
    code = re.sub(
        r'(api_key|API_KEY|apiKey)\s*=\s*["\'][^"\']+["\']',
        r'\1="***MASKED***"',
        code
    )

    # パスワードをマスク
    code = re.sub(
        r'(password|PASSWORD|pass)\s*=\s*["\'][^"\']+["\']',
        r'\1="***MASKED***"',
        code
    )

    # トークンをマスク
    code = re.sub(
        r'(token|TOKEN|auth)\s*=\s*["\'][^"\']+["\']',
        r'\1="***MASKED***"',
        code
    )

    # 接続文字列をマスク
    code = re.sub(
        r'(postgresql|mysql|mongodb)://[^"\']+',
        r'\1://USER:PASSWORD@HOST:PORT/DB',
        code
    )

    return code

# 使用例
with open('app.py', 'r') as f:
    original_code = f.read()

masked_code = mask_code(original_code)

# マスキングされたコードをAIに送信
```

### ルール5：チーム内でのルール共有

#### セキュリティガイドラインの作成

```markdown
# AI活用セキュリティガイドライン

## 禁止事項

### 絶対にAIに入力してはいけない情報
1. APIキー、パスワード、トークン
2. 実際の顧客データ
3. 社内機密情報

### 違反した場合
- 即座に上長に報告
- セキュリティチームに連絡
- APIキー等は即座に無効化

## 推奨事項

### AIに質問する前に
1. プレースホルダーに置き換える
2. サンプルデータを使う
3. マスキングスクリプトを実行

### 不明な場合
- セキュリティチームに相談
- 疑わしい場合は入力しない
```

### ルール6：定期的なレビュー

#### 月次セキュリティチェック

```markdown
## 月次セキュリティチェックリスト

### AIツール使用履歴の確認
- [ ] 機密情報の入力がないか確認
- [ ] 不適切な使用がないか確認

### 設定の確認
- [ ] 学習データ使用設定が無効になっているか
- [ ] .cursorignoreが最新か
- [ ] .gitignoreが最新か

### インシデント対応
- [ ] 過去1ヶ月のインシデント件数
- [ ] 対応済みか確認
- [ ] 再発防止策が実施されているか
```

## インシデント発生時の対応

### フロー

```
1. 発見
   ↓
2. 即座に停止（AIツールの使用を停止）
   ↓
3. 報告（上長・セキュリティチーム）
   ↓
4. 影響範囲の特定
   ↓
5. 対策実施（APIキー無効化など）
   ↓
6. 再発防止策
   ↓
7. チームへの周知
```

### 具体的な対応例

#### ケース1：APIキーを誤って送信

```bash
# 1. 即座にAPIキーを無効化
aws iam delete-access-key --access-key-id AKIA...

# 2. 新しいAPIキーを発行
aws iam create-access-key --user-name dev-user

# 3. ログを確認（不正使用がないか）
aws cloudtrail lookup-events --lookup-attributes AttributeKey=AccessKeyId,AttributeValue=AKIA...

# 4. 新しいAPIキーで環境変数を更新
# 5. チームに通知
```

#### ケース2：顧客データを誤って送信

```
1. AIプロバイダーに連絡し、データ削除を要求
2. 該当顧客に通知（場合による）
3. 法務部門に相談
4. 再発防止策の実施
5. 全メンバーへの教育
```

## 教育とトレーニング

### 新メンバーへのオンボーディング

```markdown
## AI活用セキュリティトレーニング

### Day 1：基礎知識
- AIのセキュリティリスクを理解する
- 機密情報の定義を学ぶ
- 社内ガイドラインを読む

### Day 2：実践
- プレースホルダーの使い方
- マスキングスクリプトの使い方
- .cursorignoreの設定

### Day 3：演習
- ケーススタディ
- インシデント対応シミュレーション
- 質疑応答

### 修了テスト
- セキュリティクイズ
- 実践課題
```

## まとめ

| ルール | 内容 |
|-------|------|
| 1 | プレースホルダーを使う |
| 2 | サンプルデータを使う |
| 3 | 設計書から機密情報を分離 |
| 4 | コードレビュー時のマスキング |
| 5 | チーム内でルール共有 |
| 6 | 定期的なレビュー |

**重要な原則**：
1. 疑わしい場合は入力しない
2. 事前にマスキング・プレースホルダー化
3. インシデント発生時は即座に報告
4. 定期的な教育とレビュー

技術的対策と運用ルールの両方を徹底することで、AI駆動開発のセキュリティリスクを最小化できます。

次のセクションでは、人間による最終セキュリティチェックの重要性を学びます。
